if(!window.console){window.console={log:function(){},info:function(){},error:function(){},warn:function(){},debug:function(){}}}if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}}if(!Number.prototype.toDateTime){var replaces={yyyy:function(a){return a.getFullYear().toString()},yy:function(a){return(a.getFullYear()%100).toString()},MM:function(b){var a=b.getMonth()+1;return a<10?"0"+a:a.toString()},M:function(b){var a=b.getMonth()+1;return a.toString()},dd:function(a){var b=a.getDate();return b<10?"0"+b:b.toString()},d:function(a){var b=a.getDate();return b.toString()},hh:function(b){var a=b.getHours();return a<10?"0"+a:a.toString()},h:function(b){var a=b.getHours();return a.toString()},mm:function(b){var a=b.getMinutes();return a<10?"0"+a:a.toString()},m:function(b){var a=b.getMinutes();return a.toString()},ss:function(b){var a=b.getSeconds();return a<10?"0"+a:a.toString()},s:function(b){var a=b.getSeconds();return a.toString()},a:function(b){var a=b.getHours();return a<12?"AM":"PM"}};var token=/([a-zA-Z]+)/;Number.prototype.toDateTime=function(f){var b=f||"yyyy-MM-dd hh:mm:ss";var e=new Date(this*1000);var a=b.split(token);for(var c=0;c<a.length;c++){var d=a[c];if(d&&d in replaces){a[c]=replaces[d](e)}}return a.join("")}}function encodeHtml(a){return String(a).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function parseQueryString(){var e=location.search,d={},b,f,c,a;if(e&&e.charAt(0)==="?"){a=e.substring(1).split("&");for(b=0;b<a.length;b++){c=a[b];f=c.indexOf("=");if(f<=0){continue}d[c.substring(0,f)]=decodeURIComponent(c.substring(f+1)).replace(/\+/g," ")}}return d}function gotoPage(a){var b=parseQueryString();b.page=a;location.assign("?"+$.param(b))}function refresh(){var b=new Date().getTime(),a=location.pathname;if(location.search){a=a+location.search+"&t="+b}else{a=a+"?t="+b}location.assign(a)}function toSmartDate(g){if(typeof(g)==="string"){g=parseInt(g)}if(isNaN(g)){return""}var i=new Date(g_time),a=i.getTime(),l="1分钟前",k=a-g;if(k>604800000){var f=new Date(g);var j=f.getFullYear(),b=f.getMonth()+1,h=f.getDate(),c=f.getHours(),e=f.getMinutes();l=j===i.getFullYear()?"":j+"年";l=l+b+"月"+h+"日"+c+":"+(e<10?"0":"")+e}else{if(k>=86400000){l=Math.floor(k/86400000)+"天前"}else{if(k>=3600000){l=Math.floor(k/3600000)+"小时前"}else{if(k>=60000){l=Math.floor(k/60000)+"分钟前"}}}}return l}$(function(){$(".x-smartdate").each(function(){$(this).removeClass("x-smartdate").text(toSmartDate($(this).attr("date")))})});function Template(b){var e,a,f=["var r=[];\nvar _html = function (str) { return str.replace(/&/g, '&amp;').replace(/\"/g, '&quot;').replace(/'/g, '&#39;').replace(/</g, '&lt;').replace(/>/g, '&gt;'); };"],d=/\{\s*([a-zA-Z\.\_0-9()]+)(\s*\|\s*safe)?\s*\}/m,c=function(g){f.push("r.push('"+g.replace(/\'/g,"\\'").replace(/\n/g,"\\n").replace(/\r/g,"\\r")+"');")};while(a=d.exec(b)){if(a.index>0){c(b.slice(0,a.index))}if(a[2]){f.push("r.push(String(this."+a[1]+"));")}else{f.push("r.push(_html(String(this."+a[1]+")));")}b=b.substring(a.index+a[0].length)}c(b);f.push("return r.join('');");e=new Function(f.join("\n"));this.render=function(g){return e.apply(g)}}$(function(){console.log("Extends $form...");$.fn.extend({showFormError:function(a){return this.each(function(){var b=$(this),c=b&&b.find(".alert-danger"),d=a&&a.data;if(!b.is("form")){console.error("Cannot call showFormError() on non-form object.");return}b.find("input").removeClass("alert-danger");b.find("select").removeClass("alert-danger");b.find("textarea").removeClass("alert-danger");if(c.length===0){console.warn("Cannot find .alert-danger element.");return}if(a){c.text(a.message?a.message:(a.error?a.error:a)).removeClass("hidden").show();if((c.offset().top-60)<$(window).scrollTop()){$("html,body").animate({scrollTop:c.offset().top-60})}if(d){b.find("[name="+d+"]").addClass("alert-danger")}}else{c.addClass("hidden").hide()}})},showFormLoading:function(a){return this.each(function(){var b=$(this),d=b&&b.find("button[type=submit]"),c=b&&b.find("button");$span=d&&d.find("span");iconClass=$span&&$span.attr("class");if(!b.is("form")){console.error("Cannot call showFormLoading() on non-form object.");return}if(!iconClass||iconClass.indexOf("glyphicon-")<0){console.warn('Icon <i class="glyphicon-*"> not found.');return}if(a){c.attr("disabled","disabled");$span&&$span.addClass("glyphicon-refresh").addClass("glyphicon-refresh")}else{c.removeAttr("disabled");$span&&$span.removeClass("glyphicon-refresh").removeClass("glyphicon-refresh")}})},postJSON:function(a,b,c){if(arguments.length===2){c=b;b={}}return this.each(function(){var d=$(this);d.showFormError();d.showFormLoading(true);_httpJSON("POST",a,b,function(f,e){if(f){d.showFormError(f);d.showFormLoading(false)}c&&c(f,e)})})}})});function _httpJSON(e,a,c,d){var b={type:e,dataType:"json"};if(e==="GET"){b.url=a+"?"+c}if(e==="POST"){b.url=a;b.data=JSON.stringify(c||{});b.contentType="application/json"}$.ajax(b).done(function(f){if(f&&f.error){return d(f)}return d(null,f)}).fail(function(f,g){return d({error:"http_bad_response",data:""+f.status,message:"网络好像出问题了 (HTTP "+f.status+")"})})}function getJSON(b,c,d){if(arguments.length===2){d=c;c={}}if(typeof(c)==="object"){var a=[];$.each(c,function(f,e){a.push(f+"="+encodeURIComponent(e))});c=a.join("&")}_httpJSON("GET",b,c,d)}function postJSON(a,b,c){if(arguments.length===2){c=b;b={}}_httpJSON("POST",a,b,c)}if(typeof(Vue)!=="undefined"){Vue.filter("datetime",function(a){var b=a;if(typeof(a)==="number"){b=new Date(a)}return b.getFullYear()+"-"+(b.getMonth()+1)+"-"+b.getDate()+" "+b.getHours()+":"+b.getMinutes()});Vue.component("pagination",{template:'<ul class="uk-pagination"><li v-if="! has_previous" class="uk-disabled"><span><i class="uk-icon-angle-double-left"></i></span></li><li v-if="has_previous"><a v-attr="onclick:\'gotoPage(\' + (page_index-1) + \')\'" href="#0"><i class="uk-icon-angle-double-left"></i></a></li><li class="uk-active"><span v-text="page_index"></span></li><li v-if="! has_next" class="uk-disabled"><span><i class="uk-icon-angle-double-right"></i></span></li><li v-if="has_next"><a v-attr="onclick:\'gotoPage(\' + (page_index+1) + \')\'" href="#0"><i class="uk-icon-angle-double-right"></i></a></li></ul>'})}function redirect(a){var d=a.indexOf("#"),c=a.indexOf("?"),b="";if(d>=0){b=a.substring(d);a=a.substring(0,d)}a=a+(c>=0?"&":"?")+"t="+new Date().getTime()+b;console.log("redirect to: "+a);location.assign(a)}function _bindSubmit(a){a.submit(function(e){e.preventDefault();showFormError(a,null);var d=a.attr("error"),c=a.attr("success"),g=a.attr("data"),f=g?window[g](a):a.serialize();var i=a.find("button[type=submit]"),h=i.find("span"),b=h.attr("class");if(!b||b.indexOf("glyphicon")<0){h=undefined}i.attr("disabled","disabled");h&&h.addClass("glyphicon-refresh").addClass("glyphicon-refresh");postJSON(a.attr("action-url"),f,function(l,j){h&&h.removeClass("glyphicon-refresh").removeClass("glyphicon-refresh");if(l){console.log("postJSON failed: "+JSON.stringify(l));i.removeAttr("disabled");d?d():showFormError(a,l)}else{var k=c?window[c](j):false;if(k===false){i.removeAttr("disabled")}}})});a.find("button[type=submit]").removeAttr("disabled")}$(function(){$("form").each(function(){var a=$(this);if(a.attr("action-url")){_bindSubmit(a)}})});$(function(){if(location.pathname==="/"||location.pathname.indexOf("/blog")===0){$("li[data-url=blogs]").addClass("active")}});function _display_error(d,b){if(d.is(":visible")){d.hide()}var c=b.message||String(b);var a=['<div class="alert alert-danger">'];a.push("<p>Error: ");a.push(c);a.push("</p><p>Code: ");a.push(b.error||"500");a.push("</p></div>");d.html(a.join("")).slideDown()}function error(a){_display_error($("#error"),a)}function fatal(a){_display_error($("#loading"),a)};